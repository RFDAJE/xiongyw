<html><head><title>Title</title>
<style>

table {border-collapse:collapse;}
table tr:nth-child(odd)	 {background-color:#F2F2F2;}
table tr:nth-child(even) {background-color:#ffffff;}
table th{
	color:#ffffff;background-color:#555555;border:1px solid #555555;font-size:12px;padding:3px;vertical-align:top;text-align:left;
}
table td{
	border:1px solid #d4d4d4;padding:3px;padding-top:3px;padding-bottom:3px;vertical-align:top;
}

table th a:link,table th a:visited {color:#ffffff;}
table th a:hover,table th a:active {color:#dddd33;}

div { display: none; }

</style></head><body> 

<pre><b>Folder: %s</b><br>

<script language='javascript'>

// a table in 2-dimensional array & its table header
var th = ['Type','Name','Size','Modified','href'];
var table = [
['d', '.', -1, '2013-02-01 16:54', 'xxx/.'],
['-', 'avaricious', 68, '2013-02-01 16:54', 'xxxolocate'],
['d', '..', -1, '2013-02-01 16:55', 'xxx'],
['-', 'dictum', 6268, '2013-03-01 16:54', 'xxx'],
['-', 'anaerobic', 273, '2013-04-01 16:54', 'xxx'],
['-', 'metabolism', 755, '2013-05-01 16:54', 'xxx'],
['d', 'pedal', -1, '2013-06-01 16:54', 'xxx'],
['-', 'crank', 87, '2013-07-01 16:54', 'xxx'],
['-', 'spoke', 86, '2013-08-01 16:54', 'xxxx'],
['-', 'freehub', 320, '2013-12-01 16:54', 'xxx']];

/**
* hide and show DIV elements
*
* @param {String} to_hide, the id of DIV to hide
* @param {String} to_show, the id of DIV to show
* @return none
*/
function hide_n_show(to_hide, to_show){
    document.getElementById(to_hide).style.display = "none";
    document.getElementById(to_show).style.display = "block";
}


/** 
* return a compare function for sort()
*
* @param {Number} col: the index of the column to sort by
* @param {Boolean} ascending: ascending (true) or descending (false)
* @return {Function} The compare function for Array.prototype.sort()
*/
function sort_by_col(col, ascending){
    return function (a,b){
        var ord = 0;
        if(a[col] > b[col]) ord = ascending? 1 : - 1;
        if(a[col] < b[col]) ord = ascending? - 1 : 1;
        return ord;
    }
}

/**
* convert a number into string seperated by commas
*
* @param {Number} size: the size
* @return {String} a converted string
*/
function size_with_comma(size){
    if(size < 0) return "-"
    var s = "" + size;
    var result = ""
    var mod = s.length % 3;
    var n = parseInt((s.length - 1) / 3);
    if(mod == 0) mod = 3
    if(mod) result += s.substring(0, mod);
    for(var i = 0; i < n; i ++){
	result += "," + s.substring(mod + i * 3, mod + i * 3 + 3);
    }
    return result;
}


/**
* return a html table row <tr> for the header
*
* @param {Number} col: the index of the column by which the table is sorted
* @param {Boolean} ascending: ascending (true) or descending (false)
* @return {String} string to be added to the document
*/
function gen_table_header(col, asc){
    var cur_div = "d_" + th[col] + (asc? "_a" : "_d");
    /**
    * @param {Number} column: the index of the table column
    * @return {String}: a <th> in the <tr>
    */
    var header = function(column){
        return "<th><a href='javascript: hide_n_show(\"" + 
               cur_div + "\", \"d_" + th[column] +"_" + (((col === column) && asc)? 
               "d\"" : "a\"") + ")'>" + th[column] +"</a>&nbsp;" + 
               ((col === column)?(asc? "&uarr;" : "&darr;") : "&nbsp;") + "</th>";
    }

    return "<tr>" + [0,1,2,3].map(header).join(" ") + "</tr>";
}

/**
* return a content row in html
*
* @param {Array} x: an entry in the table array
* @return {String} the string to be written to the document
*/
function gen_a_table_row(x){
    var d = (x[0] === 'd');  // put text for directories <bold>, and keep type empty for files, size as '-'
    return "<tr>" + 
           "<td>" + (d? x[0] : "") + "</td>" + 
           "<td>" + (d? "<b>":"") + "<a href='" + x[4] + "'>" + x[1] + "</a>" + (d? "</b>":"") + "</td>" +
           "<td align=right>" + (d? "-": size_with_comma(x[2])) + "</td>" +  
           "<td>" + x[3] + "</td>" +
           "</tr>";
}


table = table.filter(function(x){return x[1] != '.'}).map(function(x){if(x[0] === 'd') x[1] = '/' + x[1]; return x});

/*
* sort() keeps the '/..' folder at the top
*
*@param {Function} cmp: a compare function required by sort()
*@return {Array} the array is sorted in place
*/
table.sort = function (cmp){

     var dotdot =  this.filter(function(x){return x[1] === '/..';});
     var rest = this.filter(function(x){return x[1] != '/..';}).sort(cmp);

     this.length = 0; // empty the array

     if(dotdot.length != 0){   
         this.push(dotdot[0]); 
     }

     for(var i = 0; i < rest.length; i ++){
         this.push(rest[i]);
     }

     return this;
}


/** 
* generate a div to be written to the document
* 
* @param {Number} column: the index of the column by which the table is sorted
* @param {Boolean} is_asc: ascending (true) or descending (false)
* @param {String} id: the DIV element id
* @return {String} the div content
*/
function gen_a_div(column, is_asc, id){
    var div = "";
    table.sort(sort_by_col(column, is_asc));
//    div = div + "<div id='"+ id +"' style='display:none'><table>";
    div = div + "<div id='"+ id + "'><table>";
    div = div + gen_table_header(column, is_asc);
    div = div + table.map(gen_a_table_row).join(" ");
    div = div + "</table></div>";
    return div;
}


// fold on the columns, each column produces two divs (ascending and descending)
document.write([0, 1, 2, 3].reduce(function(acc, col){ return acc + gen_a_div(col, true, 'd_' + th[col] + '_a') + gen_a_div(col, false, 'd_' + th[col] + '_d');}, "")); 

// show first DIV by default
document.getElementById("d_" + th[0] + "_d").style.display = "block";

</script>
<br><hr>
<address>Powered by <a href='http://tstool.sourceforge.net/drops/uhttpd-0.0.2.tar.gz'>uhttpd v0.0.2</a>, &copy;&nbsp;2002-2004&nbsp;<a href='mailto:xiongyw@hotmail.com'>Yuwu (Bruin) Xiong</a></address>
</body>
</html>
