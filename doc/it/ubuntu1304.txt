installation ubuntu 13.04 x86_64



- Download "ubuntu-13.04-desktop-amd64.iso" and boot from it.
- Click "install ubuntu", tick "download updates while installing" and "install this third-party software"

- video card, printer
- audio/video
+ ssd 4k trim
  - 4k should be managed by parted already
  - http://space.itpub.net/7575/viewspace-759061
  - http://zengshenghai.blog.51cto.com/58529/979204
  
  - disable journaling, under usb live environment, for each ext4 partition:

ubuntu@ubuntu:~$ sudo tune2fs -O ^has_journal /dev/sda2
tune2fs 1.42.5 (29-Jul-2012)
ubuntu@ubuntu:~$ sudo e2fsck -f /dev/sda2
e2fsck 1.42.5 (29-Jul-2012)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/sda2: 171058/6812640 files (0.2% non-contiguous), 1227135/27197440 blocks
ubuntu@ubuntu:~$ 
    
    reboot and check:

bruin@u1304:~$ dmesg|grep EXT4
[    0.933890] EXT4-fs (sda2): mounted filesystem without journal. Opts: (null)
[    1.081853] EXT4-fs (sda2): re-mounted. Opts: discard,errors=remount-ro

  - check trim is supported by the firmware:
    
    ~$ sudo hdparm -I /dev/sda |grep TRIM
     *	Data Set Management TRIM supported (limit 8 blocks)
     *	Deterministic read ZEROs after TRIM

  - /etc/fstab: adding "discard,noatime,nodiratime" for each partition, and tmpfs entries:

bruin@u1304:~$ cat /etc/fstab
# /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# <file system> <mount point>   <type>  <options>       <dump>  <pass>
# / was on /dev/sda2 during installation
UUID=59711746-f088-4929-bdea-f10d3f29e240 /               ext4    discard,noatime,nodiratime,errors=remount-ro 0       1
# /boot/efi was on /dev/sda1 during installation
UUID=E6B8-9972  /boot/efi       vfat    defaults        0       1
# swap was on /dev/sda3 during installation
UUID=ea646862-9090-4daf-8196-a551a01ac5df none            swap    sw              0       0

tmpfs /tmp       tmpfs defaults,noatime,mode=1777 0 0
tmpfs /var/tmp   tmpfs defaults,noatime,mode=1777 0 0
tmpfs /var/log   tmpfs defaults,noatime,mode=0755 0 0
tmpfs /var/spool tmpfs defaults,noatime,mode=1777 0 0

bruin@u1304:~$ 
    
   - reboot/mount and check:
bruin@u1304:~$ sudo mount -a
bruin@u1304:~$ mount 
/dev/sda2 on / type ext4 (rw,noatime,nodiratime,discard,errors=remount-ro)
proc on /proc type proc (rw,noexec,nosuid,nodev)
sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)
none on /sys/fs/cgroup type tmpfs (rw)
none on /sys/fs/fuse/connections type fusectl (rw)
none on /sys/kernel/debug type debugfs (rw)
none on /sys/kernel/security type securityfs (rw)
none on /sys/firmware/efi/efivars type efivarfs (rw)
udev on /dev type devtmpfs (rw,mode=0755)
devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)
tmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)
none on /run/lock type tmpfs (rw,noexec,nosuid,nodev,size=5242880)
none on /run/shm type tmpfs (rw,nosuid,nodev)
none on /run/user type tmpfs (rw,noexec,nosuid,nodev,size=104857600,mode=0755)
/dev/sda1 on /boot/efi type vfat (rw)
gvfsd-fuse on /run/user/bruin/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,user=bruin)
tmpfs on /tmp type tmpfs (rw,noatime,mode=1777)
tmpfs on /var/spool type tmpfs (rw,noatime,mode=1777)
tmpfs on /var/tmp type tmpfs (rw,noatime,mode=1777)
tmpfs on /var/log type tmpfs (rw,noatime,mode=0755)
bruin@u1304:~$ 

  
    
- hdd tools: gsmartcontrol, gparted, hdparm

bruin@u1304:~$ sudo hdparm -Tt /dev/sda

/dev/sda:
 Timing cached reads:   28552 MB in  2.00 seconds = 14292.27 MB/sec
 Timing buffered disk reads: 1540 MB in  3.00 seconds = 512.80 MB/sec
bruin@u1304:~$ 

- firefox cache setting:
url: about:config

browser.cache.disk.parent_directory: /tmp


- ibus
- emacs
- tex/asy
- chrome
- vbox/kvm/xen
- smb

ssh:

- sudo apt-get install openssh-server
- netstat -an|grep 22
- ps -ef|grep ssh

native zfs:

- sudo add-apt-repository ppa:zfs-native/stable
- sudo apt-get update
- sudo apt-get install ubuntu-zfs
- sudo modprobe zfs
- dmesg|grep ZFS
- lsmod|grep zfs

testing zpool using multipe partitions on /dev/sdb: 

bruin@u1304:~$ sudo parted -l /dev/sdb
Model: ATA Samsung SSD 840 (scsi)
Disk /dev/sda: 120GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End     Size    File system     Name  Flags
 1      1049kB  99.6MB  98.6MB  fat32                 boot
 2      99.6MB  112GB   111GB   ext4
 3      112GB   120GB   8532MB  linux-swap(v1)


Model: ATA Hitachi HTS54322 (scsi)
Disk /dev/sdb: 250GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  41.9GB  41.9GB
 2      41.9GB  83.9GB  41.9GB
 3      83.9GB  126GB   41.9GB
 4      126GB   168GB   41.9GB
 5      168GB   210GB   41.9GB
 6      210GB   250GB   40.3GB


bruin@u1304:~$ 


-> raidz2:

bruin@u1304:~$ sudo zpool create tank raidz2 sdb1 sdb2 
invalid vdev specification: raidz2 requires at least 3 devices
bruin@u1304:~$ sudo zpool create tank raidz2 sdb1 sdb2 sdb3
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank             39G  128K   39G   1% /tank
bruin@u1304:~$ sudo zpool destroy tank
bruin@u1304:~$ sudo zpool create tank raidz2 sdb1 sdb2 sdb3 sdb4
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank             77G  128K   77G   1% /tank
bruin@u1304:~$ sudo zpool destroy tank
bruin@u1304:~$ sudo zpool create tank raidz2 sdb1 sdb2 sdb3 sdb4 sdb5
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank            115G     0  115G   0% /tank
bruin@u1304:~$ sudo zpool destroy tank

-> raidz3:

invalid vdev specification: raidz3 requires at least 4 devices
bruin@u1304:~$ sudo zpool create tank raidz3 sdb1 sdb2 sdb3 sdb4
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank             39G     0   39G   0% /tank

-> add into zpool:

bruin@u1304:~$ sudo zpool create tank raidz2 sdb1 sdb2 sdb3
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank             39G     0   39G   0% /tank
bruin@u1304:~$ sudo zpool list
NAME   SIZE  ALLOC   FREE    CAP  DEDUP  HEALTH  ALTROOT
tank   117G   315K   117G     0%  1.00x  ONLINE  -
bruin@u1304:~$ sudo zpool status
  pool: tank
 state: ONLINE
  scan: none requested
config:

  NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  raidz2-0  ONLINE       0     0     0
	    sdb1    ONLINE       0     0     0
	    sdb2    ONLINE       0     0     0
	    sdb3    ONLINE       0     0     0

errors: No known data errors
bruin@u1304:~$ sudo cp -a /usr /tank/usr
^Cbruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank             39G  476M   38G   2% /tank
bruin@u1304:~$ sudo zpool add -f tank sdb4
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank             77G  481M   77G   1% /tank
bruin@u1304:~$ sudo zpool status
  pool: tank
 state: ONLINE
  scan: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  raidz2-0  ONLINE       0     0     0
	    sdb1    ONLINE       0     0     0
	    sdb2    ONLINE       0     0     0
	    sdb3    ONLINE       0     0     0
	  sdb4      ONLINE       0     0     0

errors: No known data errors
bruin@u1304:~$ sudo zpool list
NAME   SIZE  ALLOC   FREE    CAP  DEDUP  HEALTH  ALTROOT
tank   156G  1.41G   155G     0%  1.00x  ONLINE  -
bruin@u1304:~$ 

bruin@u1304:~$ sudo zpool add -f tank sdb5 
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank            116G  481M  115G   1% /tank
bruin@u1304:~$ sudo zpool add -f tank sdb6
bruin@u1304:~$ df -h /tank
Filesystem      Size  Used Avail Use% Mounted on
tank            152G  481M  152G   1% /tank
bruin@u1304:~$ sudo zpool list
NAME   SIZE  ALLOC   FREE    CAP  DEDUP  HEALTH  ALTROOT
tank   232G  1.41G   231G     0%  1.00x  ONLINE  -
bruin@u1304:~$ sudo zpool status
  pool: tank
 state: ONLINE
  scan: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	tank        ONLINE       0     0     0
	  raidz2-0  ONLINE       0     0     0
	    sdb1    ONLINE       0     0     0
	    sdb2    ONLINE       0     0     0
	    sdb3    ONLINE       0     0     0
	  sdb4      ONLINE       0     0     0
	  sdb5      ONLINE       0     0     0
	  sdb6      ONLINE       0     0     0

errors: No known data errors
bruin@u1304:~$ 


+ htop

+ ibus:

  ibus-daemon -drx
  
+ smth
  http://www.newsmth.net/bbstcon.php?board=LinuxApp&gid=784272

bruin@u1304:~$ cat smth
#!/usr/bin/expect -f
spawn luit -encoding gbk telnet bbs.newsmth.net
interact {
        timeout 30 { send "\0"}
        }
  
